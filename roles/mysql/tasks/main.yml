- name: register mycnf
  stat:
    path: /etc/my.cnf
  register: mycnf

- name: create backup directory
  become: yes
  file:
    path: /backup
    state: directory

- name: backup mysql file
  become: yes
  copy:
    remote_src: yes
    src: /etc/my.cnf
    dest: /backup/my.cnf
  when: mycnf.stat.exists

- name: copy mysql setting
  become: yes
  copy:
    src: files/my.cnf
    dest: /etc/my.cnf

- name: copy mysql setting
  become: yes
  copy:
    src: files/my.cnf
    dest: /etc/my.cnf

- name: restart mysql
  become: yes
  command: systemctl restart mysql

- name: get myprofiler
  become: yes
  get_url:
    url: https://github.com/KLab/myprofiler/releases/download/0.1/myprofiler.linux_amd64.tar.gz
    dest: /tmp

- name: add myprofiler directory
  become: yes
  file:
    path: /tmp/myprofiler
    state: directory

- name: unzip myprofiler
  become: yes
  unarchive:
    src: /tmp/myprofiler.linux_amd64.tar.gz
    dest: /tmp/myprofiler
    remote_src: yes

- name: copy myprofiler
  become: yes
  copy:
    src: /tmp/myprofiler/myprofiler
    dest: /usr/bin/myprofiler
    mode: 755
    remote_src: yes
